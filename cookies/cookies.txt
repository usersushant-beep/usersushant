from selenium import webdriver
from selenium.webdriver.chrome.options import Options
import os

options = Options()

prefs = {'exit_type': 'Normal'}
options.add_experimental_option("prefs", {'profile': prefs})
options.add_argument(f"user-data-dir={os.getcwd()}/chrome")
options.add_argument("user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36")
options.add_argument("no-sandbox")
options.add_argument('start-maximized')
options.add_argument('disable-infobars')
options.add_argument("--autoplay-policy=no-user-gesture-required")
options.add_experimental_option("excludeSwitches", ['enable-automation'])

driver = webdriver.Chrome(options=options)

def save_cookies_to_netscape_file(cookies, output_file):
    with open(output_file, 'w') as f:
        f.write("# Netscape HTTP Cookie File\n")
        f.write("# This is a generated file! Do not edit.\n\n")
        f.write("# domain  include_subdomains  path  secure  expiration_date  name  value\n")

        for cookie in cookies:
            expiry = int(cookie['expiry']) if 'expiry' in cookie else 0
            
            f.write(f"{cookie['domain']}\t")
            f.write("TRUE\t")  # include_subdomains
            f.write(f"{cookie['path']}\t")
            f.write("TRUE\t" if cookie.get('secure') else "FALSE\t")
            f.write(f"{expiry}\t")  # expiration_date
            f.write(f"{cookie['name']}\t{cookie['value']}\n")

    return f"Cookies have been saved to {output_file}"

# Ensure user logs in before retrieving cookies
while True:
    user_input = input("Login to your YouTube account and play a video. Done? (Y/N): ").strip().upper()
    if user_input == "Y":
        break
    print("Please enter 'Y' when you have completed the login.")

print("Hello, Logged in to your account..!")

# Get the filename for cookies
while True:
    user_input = input("Enter a name for your cookies file: ").strip()
    if user_input:
        output_file = user_input + ".txt"
        break

# Retrieve cookies
cookies = driver.get_cookies()
if not cookies:
    print("No cookies retrieved! Ensure you are logged in and the site allows cookies.")
else:
    output_file = os.path.join(os.getcwd(), output_file)
    save_cookies_to_netscape_file(cookies, output_file)
    print("Cookies saved to:", output_file)

driver.quit()
